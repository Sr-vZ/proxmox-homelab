# Network

The proxmox is currently connected via a tenda router with a LAN and WLAN as backup

192.168.0.250 LAN
192.168.0.254 WLAN

This is from Tenda 192.168.0.100 DHCP Pool

The plan is to segregate the Tenda LAN/WAN and Proxmox LAN

# Proxmox Interface config

```
# network interface settings; autogenerated
# Please do NOT modify this file directly, unless you know what
# you're doing.
#
# If you want to manage parts of the network configuration manually,
# please utilize the 'source' or 'source-directory' directives to do
# so.
# PVE will preserve these directives, but will NOT read its network
# configuration from sourced files, so do not attempt to move any of
# the PVE managed interfaces into external files!

auto lo
iface lo inet loopback

auto wlp1s0
iface wlp1s0 inet static
        address 192.168.0.250/24
        wpa-ssid "Desk N/W-5G"
        wpa-psk "93308desk"
        post-up echo 1 > /proc/sys/net/ipv4/ip_forward
        post-up iptables -t nat -A POSTROUTING -s '10.10.10.0/24' -o wlp1s0 -j MASQUERADE
        post-down iptables -t nat -D POSTROUTING -s '10.10.10.0/24' -o wlp1s0 -j MASQUERADE
        post-up   iptables -t raw -I PREROUTING -i fwbr+ -j CT --zone 1
        post-down iptables -t raw -D PREROUTING -i fwbr+ -j CT --zone 1
#WIFI

auto eno1
iface eno1 inet manual

auto vmbr1
iface vmbr1 inet static
        address 10.0.0.1/24
        bridge-ports none
        bridge-stp off
        bridge-fd 0
        bridge-vlan-aware yes
        bridge-vids 2-4094
        post-up iptables -t nat -A POSTROUTING -s '10.0.0.0/24' -o vmbr0 -j MASQUERADE
        post-down iptables -t nat -D POSTROUTING -s '10.0.0.0/24' -o vmbr0 -j MASQUERADE
#LAN

auto vmbr0
iface vmbr0 inet static
        address 192.168.0.251/24
        gateway 192.168.0.1
        bridge-ports eno1
        bridge-stp off
        bridge-fd 0
        up route add -net 192.168.0.0 netmask 255.255.255.0 gw 192.168.0.251 eth0
#WAN

post-up iptables -t nat -A PREROUTING -i vmbr0 -p tcp --dport 80 -j DNAT --to 10.0.0.xxx:80
post-down iptables -t nat -D PREROUTING -i vmbr0 -p tcp --dport 80 -j DNAT --to 10.0.0.xxx:80
source /etc/network/interfaces.d/*
```

# VyOS

Virtual router for 10.0.0.1/24
This will DHCP and Internet Gateway for 10.0.0.1/24
Require SNAT config

VyOS config:

```
interfaces {
    ethernet eth0 {
        address dhcp
        description WAN
        hw-id bc:24:11:b7:eb:56
        offload {
            gro
            gso
            sg
            tso
        }
    }
    ethernet eth1 {
        address 10.0.0.1/24
        description LAN
        hw-id bc:24:11:10:b1:c8
        offload {
            gro
            gso
            sg
            tso
        }
    }
    loopback lo {
    }
}
nat {
    source {
        rule 100 {
            log
            outbound-interface {
                name eth0
            }
            source {
                address 10.0.0.0/24
            }
            translation {
                address masquerade
            }
        }
    }
}
service {
    dhcp-server {
        shared-network-name LAN {
            subnet 10.0.0.0/24 {
                lease 86400
                option {
                    default-router 10.0.0.1
                }
                range 0 {
                    start 10.0.0.9
                    stop 10.0.0.254
                }
                subnet-id 1
            }
        }
    }
    dns {
        forwarding {
            allow-from 10.0.0.0/24
            cache-size 0
            listen-address 10.0.0.1
            listen-address 192.168.0.181
            name-server 192.168.0.1 {
            }
        }
    }
    ntp {
        allow-client {
            address 127.0.0.0/8
            address 169.254.0.0/16
            address 10.0.0.0/8
            address 172.16.0.0/12
            address 192.168.0.0/16
            address ::1/128
            address fe80::/10
            address fc00::/7
        }
        server time1.vyos.net {
        }
        server time2.vyos.net {
        }
        server time3.vyos.net {
        }
    }
    ssh {
        port 22
    }
}
system {
    config-management {
        commit-revisions 100
    }
    console {
        device ttyS0 {
            speed 115200
        }
    }
    host-name vyos
    login {
        user vyos {
            authentication {
                encrypted-password ****************
                plaintext-password ****************
            }
        }
    }
    syslog {
        global {
            facility all {
                level info
            }
            facility local7 {
                level debug
            }
        }
    }
}
```

# Jump Server

A jump host might be required for SSH into the Proxmox VMs as those won't be available for 192.168.0.1/24
Using vyos as jumpserver as it'll be the only VM which will be connected to 192.168.0.1/24 subnet

```
ssh -J vyos@<vyos-IP> user@<vm-IP>
```

Add ssh public key better seamless passwordless jumping around
